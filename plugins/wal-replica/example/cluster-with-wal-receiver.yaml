apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: sample-wal-cluster
  namespace: default
spec:
  instances: 1
  imageName: ghcr.io/cloudnative-pg/postgresql:16
  storage:
    size: 1Gi
  superuserSecret:
    name: sample-wal-superuser
  bootstrap:
    initdb:
      database: appdb
      owner: appuser
      secret:
        name: sample-wal-app-user
  postgresql:
    parameters:
      wal_level: replica
      archive_mode: "on"
      archive_timeout: "60s"
  plugins:
    - name: cnpg-i-wal-replica.documentdb.io
      parameters:
        enabled: "true"
        replicationUser: streaming_replica
        replicationPasswordSecretName: sample-wal-repl
        synchronous: "true"
        walDirectory: /var/lib/wal
  # optional service exposure
  primaryUpdateStrategy: unsupervised
  enableSuperuserAccess: true
---
apiVersion: v1
kind: Secret
metadata:
  name: sample-wal-superuser
  namespace: default
stringData:
  username: postgres
  password: supersecret
---
apiVersion: v1
kind: Secret
metadata:
  name: sample-wal-app-user
  namespace: default
stringData:
  username: appuser
  password: appsecret
---
apiVersion: v1
kind: Secret
metadata:
  name: sample-wal-repl
  namespace: default
stringData:
  username: streaming_replica
  password: replsecret
